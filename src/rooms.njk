---
layout: layouts/base.njk
title: Rooms
---
<section class="card">
  <h2 class="text-xl font-semibold">Rooms</h2>
  <div id="rooms" class="mt-3 grid gap-3 sm:grid-cols-2 lg:grid-cols-3"></div>
</section>
<section class="card mt-6">
  <h3 class="text-lg font-semibold">Add / Edit Room</h3>
  <form id="roomForm" class="mt-3 grid gap-3 sm:grid-cols-2">
    <input type="hidden" name="id" id="id" />
    <div class="sm:col-span-1">
      <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
      <input id="name" name="name" required class="mt-1 block w-full rounded-lg border-gray-300 focus:border-brand-500 focus:ring-brand-500" />
    </div>
    <div class="sm:col-span-1">
      <label for="floor" class="block text-sm font-medium text-gray-700">Floor</label>
      <input id="floor" name="floor" class="mt-1 block w-full rounded-lg border-gray-300 focus:border-brand-500 focus:ring-brand-500" />
    </div>
    <div class="sm:col-span-1">
      <label for="dimensions" class="block text-sm font-medium text-gray-700">Dimensions</label>
      <input id="dimensions" name="dimensions" class="mt-1 block w-full rounded-lg border-gray-300 focus:border-brand-500 focus:ring-brand-500" />
    </div>
    <div class="sm:col-span-2">
      <label for="notes" class="block text-sm font-medium text-gray-700">Notes</label>
      <textarea id="notes" name="notes" class="mt-1 block w-full rounded-lg border-gray-300 focus:border-brand-500 focus:ring-brand-500" rows="3"></textarea>
    </div>
    <div class="sm:col-span-2">
      <button class="btn w-full sm:w-auto" type="submit">Save</button>
    </div>
  </form>
  <p id="msg" class="muted mt-2"></p>
</section>
<script>
(async function() {
  const listEl = document.getElementById('rooms');
  const form = document.getElementById('roomForm');
  const msg = document.getElementById('msg');
  async function loadRooms() {
    const r = await fetch('/.netlify/functions/rooms.list');
    if (r.status === 401) { location.href = '/'; return; }
    const rooms = await r.json();
    listEl.innerHTML = rooms.map(r => `
      <div class=\"rounded-xl border border-gray-200 p-4 bg-white\">
        <div class=\"flex items-center justify-between\">
          <div>
            <div class=\"font-medium\">${r.name}</div>
            <div class=\"text-sm muted\">${(r.floor||'') + ' ' + (r.dimensions||'')}</div>
          </div>
        </div>
        ${r.notes ? `<p class=\"text-sm mt-2\">${r.notes}</p>` : ''}
      </div>`).join('') || '<p class="muted">No rooms yet.</p>';
  }
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = '';
    const payload = Object.fromEntries(new FormData(form).entries());
    if (!payload.id) delete payload.id;
    const res = await fetch('/.netlify/functions/rooms.upsert', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (res.ok) {
      form.reset();
      msg.textContent = 'Saved';
      await loadRooms();
    } else {
      const t = await res.text();
      msg.textContent = t || 'Error';
    }
  });
  await loadRooms();
})();
</script>
